# STEP第２週
## 宿題1 $\mathcal{O}(1)$で動くハッシュテーブル

ソースファイルは```hash.py```である．<br>
まず，hash関数はそのままでdeleteのみを実装した．
実行時間は以下の通り．

| iteration | 0 | 10 | max(23) | 99 | delete |
| ---: | :---: | :---: | :---: | :---: | :---: |
| time[s] | 0.190285 | 4.553874 | 13.036474 | - | - |

次に，再ハッシュを実装した．
| iteration | 0 | 10 | max(23) | 99 | delete |
| ---: | :---: | :---: | :---: | :---: | :---: |
| time[s] | 0.437019 | 4.151171 | 12.686049 | - | - |

ハッシュテーブルの拡張を行なっても実行時間がほとんど短縮されなかったので，hash関数の改善を考えた．

まず，以下のように7倍する処理を加えた．7という数字は適当に選んだ（keyが9文字でもhash値が32bitくらいで収まる・素数なので同じ値になりにくそう）．
```Python
def calculate_hash(key):
    assert type(key) == str
    hash = 0
    for i in key:
        hash *= 7  # added
        hash += ord(i)
    return hash
```

```hash_shrink```未実装
| iteration | 0 | 10 | max(56) | 98 | delete |
| ---: | :---: | :---: | :---: | :---: | :---: |
| time[s] | 0.081437 | 0.038373 | 2.502577 | 0.041099 | 1.757567 |

```hash_shrink```実装後
| iteration | 0 | 10 | max(56) | 99 | delete |
| ---: | :---: | :---: | :---: | :---: | :---: |
| time[s] | 0.084704 | 0.147761 | 2.968872 | 0.041953 | 5.342292 |

次に，乗数を131に変更した．131は，ASCII文字の文字数128よりも大きい最小の素数である．
実行結果は以下の通りで，乗数が7の場合からほとんど変わらなかった．
| iteration | 0 | 10 | max(56) | 99 | delete |
| ---: | :---: | :---: | :---: | :---: | :---: |
| time[s] | 0.092642 | 0.039777 | 3.164390 | 0.041205 | 5.474344 |

<br>

### <考えたこと>
- 他にも，乗数を大きくしたり，文字の位置によって掛ける数字を変えたりしてみたが，処理速度はあまり改善されなかった．今回のハッシュテーブルでは，衝突よりもhash値の計算コストのほうが実行速度への影響が大きいと感じた．
- 入力の文字列から最適なhash関数を推測する方法がありそうだが，この1週間では思いつかなかった．
- 今回のハッシュテーブルは要素数が奇数となるように設計したが，リハッシュを考慮すると要素数が $2^n$ の方が効率が良いのでは無いかと考えた．そこで，```hash_table_bi.py```に実装してみた．実行速度は約3%ほど改善されたが，期待したほど速くはならなかった．

<br>

## 宿題2 現実のデータベースでハッシュテーブルよりも木構造が好まれる理由
- メモリの確保量が少なくて済む
- データに大小関係を持たせることができる（stackやqueueのようにも使える）
- ハッシュ関数を考える手間がない（データの傾向により適切なハッシュ関数が異なる）
- ハッシュではリハッシュ時に10~100倍の時間がかかる．木構造でデータの挿入・削除は$\mathcal{O}(\log N)$で安定．

<br>

## 宿題3 キャッシュの管理をほぼ $\mathcal{O}(1)$ で実現できるデータ構造
- ハッシュテーブルに双方向リストを組み合わせる．具体的には，```Item```にアクセス時間が前後の```Item```のポインタを持たせる．そして，ハッシュテーブルには最新と一番昔の```Item```のポインタを記憶させる．
