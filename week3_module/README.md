# STEP第３週 自作電卓プログラム

## **プログラムの実行方法**
※ C++11以降で実行してください．
```
$ g++ --std=c++11 -o modularized_calculator modularized_calculator.cpp
$ ./modularized_calculator
```
使用例
```
$ ./modularized_calculator
> 1 + 2
answer = 3
```

## **使い方**
- ```>``` が表示されているときは入力モードです．
- 対応演算
  - ```+```，```-```，```*```，```/```，```abs```，```int```，```round```
- 数字と記号の間に半角余白を含めることができます．ただし，数字の中に半角余白を含めることはできません．
  - OK: ```1 + 2 * (3 + 4)```
  - NG: ```123 456.7```，```123456. 7```
- 入力された式に不備があった場合や正常に処理できなかった場合は，[エラー文](#エラー文一覧)が出力され，再び入力モードになります．
  
## **工夫した点**
- トークンのタイプに通し番号を振り，数字で管理するようにしました．
- 読み込む文字の種類や演算の種類によって関数を分ける（モジュール化する）ことで，保守性を高めました．
- 式の計算順序通りに処理が実行されるように考えて，関数を組み立てました．
- 入力式の評価中に異常が検出されても計算プログラム自体の実行が終了してしまわないように，exit関数の使用を避けました．
- exit関数の代替として ```optional<T>``` の使用を考えましたが，コードが煩雑になり読みづらくなると感じたため，```quiet_NaN()```（演算で伝播するNaN）を返すようにしました．その代わり，エラー文を充実させました．
- ```abs``` などの文字列の関数を読み取ってtokenizeする際，未対応の関数やタイプミスだった場合に ```TYPO``` という1種のタイプを割り当てるようにしました．こうすることで，エラー処理がやりやすくなりました．
- ```abs```，```int```，```round```の3つは必ず括弧囲みで引数をとるので，括弧を扱う関数内でまとめて処理しました．

## **エラー文一覧**
- ```ERROR: invalid character found: "<char>" (index <num>)```
  - ```num``` 番目に不正な文字 ```char``` が検出されました．
- ```ERROR: unsupported functions or typo```
  - 非対応の関数が含まれている，またはタイプミスしています．
- ```ERROR: divide by zero```
  - 0割りが発生しました．
- ```ERROR: missing opening bracket```
  - 開き括弧が不足しています（閉じ括弧が過剰です）．
- ```ERROR: missing closing bracket```
  - 閉じ括弧が不足しています．
- ```ERROR: consecutive operators (token index: <num>)```
  - ```num``` 番目で演算子が連続しています．
- ```something wrong :(```
  - なんらかの原因で正しく計算処理が終了しませんでした．
  - （多くの場合，他のエラー文が直前に出力されます．）
